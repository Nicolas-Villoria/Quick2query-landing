---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';
import BackgroundGradient from '../components/BackgroundGradient.jsx';
---

<Layout title="Join Waitlist - Quick2query">
  <main class="min-h-screen relative">
    <!-- Background Gradient -->
    <div class="absolute inset-0 z-0">
      <BackgroundGradient client:load />
    </div>

    <!-- Top Navigation -->
    <div class="relative z-10 flex justify-between items-center p-6 lg:p-8">
      <!-- Logo on Top Left -->
      <div class="flex items-center space-x-3">
        <a href="/" class="flex items-center space-x-3 hover:opacity-80 transition-opacity duration-200">
          <img src="/logo.png" alt="Quick2query Logo" class="w-12 h-12"/>
          <span class="text-2xl font-bold text-gray-900">Quick2query</span>
        </a>
      </div>

      <!-- Back to Home on Top Right - Hidden on mobile -->
      <div class="hidden md:flex items-center space-x-4">
        <a 
          href="/" 
          class="px-6 py-2 bg-tech text-white rounded-lg hover:bg-tech/90 transition-all duration-200 font-medium shadow-md"
        >
          Back to Home
        </a>
      </div>
    </div>

    <!-- Centered Waitlist Card -->
    <div class="relative z-10 flex items-center justify-center min-h-[calc(100vh-120px)] px-6 pb-12">
      <div class="w-full max-w-lg">
        <!-- Waitlist Card -->
        <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 md:p-10 border-2 border-tech/20">
          <!-- Card Header -->
          <div class="text-center mb-8">
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-tech/10 text-tech font-medium text-sm mb-4 border border-tech/20">
              <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-tech opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-tech"></span>
              </span>
              Launching Soon - Limited Early Access
            </div>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">Join the Early Access Waitlist</h2>
            <p class="text-gray-600 text-lg">Be among the first to experience Quick2query when we launch. Get exclusive early access and special pricing.</p>
          </div>

          <!-- Success Message (hidden by default) -->
          <div id="success-message" class="hidden mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-lg">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <div>
                <p class="font-semibold text-green-900">You're on the list!</p>
                <p class="text-sm text-green-700">We'll notify you when Quick2query launches.</p>
              </div>
            </div>
          </div>

          <!-- Waitlist Form -->
          <form id="waitlist-form" class="space-y-6">
            <!-- Full Name -->
            <div>
              <label for="full-name" class="block text-sm font-semibold text-gray-900 mb-2">
                Full Name<span class="text-red-500 ml-1">*</span>
              </label>
              <input 
                type="text" 
                name="full-name" 
                id="full-name"
                autocomplete="name"
                required
                class="block w-full rounded-lg border-0 bg-gray-50 px-4 py-3.5 text-gray-900 shadow-sm ring-2 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tech sm:text-sm transition-all duration-200"
                placeholder="John Smith"
              />
            </div>

            <!-- Email Field -->
            <div>
              <label for="email" class="block text-sm font-semibold text-gray-900 mb-2">
                Email Address<span class="text-red-500 ml-1">*</span>
              </label>
              <input 
                type="email" 
                name="email" 
                id="email"
                autocomplete="email"
                required
                class="block w-full rounded-lg border-0 bg-gray-50 px-4 py-3.5 text-gray-900 shadow-sm ring-2 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tech sm:text-sm transition-all duration-200"
                placeholder="john@company.com"
              />
            </div>

            <!-- Optional: Company/Organization -->
            <div>
              <label for="company" class="block text-sm font-semibold text-gray-900 mb-2">
                Company/Organization <span class="text-gray-400 text-xs">(Optional)</span>
              </label>
              <input 
                type="text" 
                name="company" 
                id="company"
                autocomplete="organization"
                class="block w-full rounded-lg border-0 bg-gray-50 px-4 py-3.5 text-gray-900 shadow-sm ring-2 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tech sm:text-sm transition-all duration-200"
                placeholder="Acme Corp"
              />
            </div>

            <!-- Newsletter Checkbox -->
            <div class="flex items-start">
              <div class="flex items-center h-5">
                <input 
                  id="newsletter" 
                  name="newsletter" 
                  type="checkbox"
                  checked
                  class="h-4 w-4 rounded border-gray-300 text-tech focus:ring-tech"
                />
              </div>
              <div class="ml-3 text-sm">
                <label for="newsletter" class="text-gray-600">
                  Send me updates about Quick2query and product announcements
                </label>
              </div>
            </div>

            <!-- GDPR Privacy Notice -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="text-xs text-blue-800">
                  <p class="font-semibold mb-1">Privacy Notice (GDPR)</p>
                  <p>By submitting this form, you consent to Quick2query storing your personal data (name, email, company) to notify you about our product launch and updates. You can unsubscribe at any time. Read our <a href="/privacy" class="underline hover:text-blue-900">Privacy Policy</a> for details.</p>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full flex justify-center items-center gap-2 rounded-lg bg-gradient-to-r from-tech to-primary px-6 py-4 text-base font-semibold text-white shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all duration-200"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
              Join the Waitlist
            </button>
          </form>

          <!-- Additional Info -->
          <div class="mt-8 pt-6 border-t border-gray-200">
            <div class="flex items-start space-x-3 text-sm text-gray-600">
              <svg class="w-5 h-5 text-tech mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
              </svg>
              <p>Your information is secure and will only be used to notify you about Quick2query's launch. We respect your privacy.</p>
            </div>
          </div>
        </div>

        <!-- Mobile Back Button -->
        <div class="md:hidden mt-6 text-center">
          <a href="/" class="text-tech hover:text-tech/80 font-medium">
            ‚Üê Back to Home
          </a>
        </div>
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('waitlist-form') as HTMLFormElement;
    const successMessage = document.getElementById('success-message');
    const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Disable submit button to prevent double submissions
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = `
          <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Joining...</span>
        `;
      }

      const formData = new FormData(form);
      const data = {
        name: formData.get('full-name'),
        email: formData.get('email'),
        company: formData.get('company') || '',
        newsletter: formData.get('newsletter') === 'on' ? 'Yes' : 'No',
        timestamp: new Date().toISOString()
      };

      // Validate email
      if (!data.email || typeof data.email !== 'string' || !data.email.includes('@')) {
        alert('Please enter a valid email address.');
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerHTML = `
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Join the Waitlist
          `;
        }
        return;
      }

      try {
        // Submit to Google Apps Script
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycby-u990kBWL1w8xV8lp7edL1qCAy9S7WLM3384TxasCE93AFydYAfB9Q2YmUIpCPdfGYw/exec",
          {
            method: "POST",
            mode: "no-cors", // Google Apps Script requires no-cors
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          }
        );

        // With no-cors, we won't get a readable response, so we assume success
        // Show success message
        successMessage?.classList.remove('hidden');
        form.reset();

        // Scroll to success message
        successMessage?.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Hide success message after 8 seconds
        setTimeout(() => {
          successMessage?.classList.add('hidden');
        }, 8000);

      } catch (error) {
        console.error('Error submitting waitlist:', error);
        alert('There was an error joining the waitlist. Please try again or contact us directly.');
      } finally {
        // Re-enable submit button
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerHTML = `
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            Join the Waitlist
          `;
        }
      }
    });
  });
</script>